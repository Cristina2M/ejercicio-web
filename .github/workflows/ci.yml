name: CI Ejercicio completo

on:
  push:
    branches:
      - 'feature/**'
      - 'deploy'
      - 'release/**'
      - 'main'
  pull_request:
    branches:
      - 'deploy'
      - 'release/**'

jobs:
  verificar-js:
    name: 1) Verificar archivos .js
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v5.0.0

      - name: Buscar archivos .js
        run: |
          JS_FILES=$(find . -type f -name "*.js")
          if [ -z "$JS_FILES" ]; then
            echo "No se encontraron archivos .js en esta rama."
            exit 1
          fi

  tests:
    name: 2) Tests unitarios
    runs-on: ubuntu-latest
    needs: verificar-js
    if: needs.verificar-js.result == 'success'   # solo si verificar-js pas√≥
    steps:
      - name: Checkout
        uses: actions/checkout@v5.0.0

      - name: Configurar Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Instalar dependencias
        run: npm ci || npm install

      - name: Ejecutar tests
        run: npm test

      # Paso opcional: mostrar mensaje si fallan los tests
      - name: Mostrar mensaje si fallan los tests
        if: failure()
        run: echo "Los tests unitarios fallaron. Deteniendo el pipeline."

